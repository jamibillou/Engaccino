//= require jquery
//= require jquery-ui
//= require jquery_ujs
//= require jquery.purr
//= require best_in_place
//= require i18n
//= require i18n/translations
//= require rails.validations

$(document).ready(function() {
  
  /* AUTOCOMPLETE */
  $('input.country').each(function() { $(this).autocomplete({ source:"/ajax/countries", minLength: 2, autoFocus: true }); });
  $('input.month').each(function()   { $(this).autocomplete({ source:"/ajax/months",    minLength: 1 }); });
  $('input.year').each(function()    { $(this).autocomplete({ source:"/ajax/years",     minLength: 2 }); });

	customForm('search_bar_form', '');
	$('#close_flash').click(function() { $('#flash').hide(); })
	
});

/* CUSTOMS ALL FIELDS OF THE GIVEN FORM */
function customForm(formId, translationPath)
{
  $("#"+formId+" input").each(function() {
  	if (!$(this).hasClass("hidden") && $(this).attr("type") != "hidden") { customInputField($(this).attr("id"), I18n.t(translationPath+$(this).attr("id")), formId, $(this).attr("type")); }
  });
  
  $("#"+formId).submit(function() { emptyDefaultValuesForm(formId, translationPath); });
}

/* CUSTOMS THE GIVEN FIELD */
function customInputField(inputFieldId, inputFieldDefaultValue, formId, inputFieldType) {
	(inputFieldType == "password") ? styleInputPasswordField(inputFieldId, inputFieldDefaultValue) : styleInputField(inputFieldId, inputFieldDefaultValue)
}

/* STYLES THE GIVEN INPUT FIELD */
function styleInputField(inputFieldId, inputFieldDefaultValue)
{
	$("#"+inputFieldId).ready(function() {
		if ($("#"+inputFieldId).val() == inputFieldDefaultValue) {
      $("#"+inputFieldId).css("color", "#7c7777");
      $("#"+inputFieldId).css("font-style", "italic");
    } else {
      $("#"+inputFieldId).css("color", "#444");
      $("#"+inputFieldId).css("font-style", "normal");
    }	    	    
	});
	
	$("#"+inputFieldId).focus(function() {
		if ($("#"+inputFieldId).val() == inputFieldDefaultValue) { $("#"+inputFieldId).css("color", "#acacb3"); }
	});

	$("#"+inputFieldId).keydown(function() {
		if ($("#"+inputFieldId).val() == inputFieldDefaultValue) { $("#"+inputFieldId).val(""); $("#"+inputFieldId).css("font-style", "normal"); $("#"+inputFieldId).css("color", "#444");	}
	});

	$("#"+inputFieldId).blur(function() {
		if($("#"+inputFieldId).val() == "" || $("#"+inputFieldId).val() == inputFieldDefaultValue) {
			$("#"+inputFieldId).css("font-style", "italic"); $("#"+inputFieldId).css("color", "#7c7777");
			if($("#"+inputFieldId).val() == "") { $("#"+inputFieldId).val(inputFieldDefaultValue); }
		}
	});
}

/* STYLES THE GIVEN PASSWORD FIELD */
function styleInputPasswordField(inputFieldId, inputFieldDefaultValue)
{
  $("#"+inputFieldId).after("<input class='field' id='"+inputFieldId+"_placeholder' type='text' value='"+inputFieldDefaultValue+"' />");
	$("#"+inputFieldId+"_placeholder").css("color", "#7c7777");
  $("#"+inputFieldId+"_placeholder").css("font-style", "italic");
	$("#"+inputFieldId+"_placeholder").show();	
	$("#"+inputFieldId).hide();
	
	$("#"+inputFieldId+"_placeholder").focus(function() { $("#"+inputFieldId+"_placeholder").css("color", "#acacb3");	});
	
	$("#"+inputFieldId+"_placeholder").keydown(function() {
		$("#"+inputFieldId+"_placeholder").hide(); $("#"+inputFieldId).val(""); $("#"+inputFieldId).show(); $("#"+inputFieldId).focus();
	});
	
	$("#"+inputFieldId+"_placeholder").blur(function() {
		if ($("#"+inputFieldId+"_placeholder").val() == "" || $("#"+inputFieldId+"_placeholder").val() == inputFieldDefaultValue) {	$("#"+inputFieldId+"_placeholder").css("color", "#7c7777"); }		
	});
	
	$("#"+inputFieldId).blur(function() {
		if($("#"+inputFieldId).val() == "" || $("#"+inputFieldId).val() == inputFieldDefaultValue) {			
			$("#"+inputFieldId+"_placeholder").show(); $("#"+inputFieldId).hide(); $("#"+inputFieldId+"_placeholder").css("color", "#7c7777");
		}		
	});
}

/* GIVEN A FORM, EMPTIES FIELDS THAT HAVE DEFAULT VALUES */
function emptyDefaultValuesForm(formId, translationPath) {
  $("#"+formId+" input").each(function() {
  	if (!$(this).hasClass("hidden") && $(this).attr("type") != "hidden") { emptyDefaultValueField($(this).attr("id"), I18n.t(translationPath+$(this).attr("id"))); }
  });
}

/* EMPTIES THE GIVEN FIELD IF IT HAS THE DEFAULT VALUE */
function emptyDefaultValueField(inputFieldId, inputFieldDefaultValue) {
  if ($("#"+inputFieldId).val() == inputFieldDefaultValue) { $("#"+inputFieldId).val(""); }
}

/* REVEALS THE GIVEN ITEM WHEN THE MOUSE IS OVER THE GIVEN BLOCK */
function revealItem(itemToRevealId, blockToHoverId) {
  $("#"+blockToHoverId).mouseenter(function() { $("#"+itemToRevealId).show(); });
  $("#"+blockToHoverId).mouseleave(function() { $("#"+itemToRevealId).hide(); });
}

function delete_fields(link) {
  $(link).prev("input[type=hidden]").val("1"); $(link).parent().hide();
}

function add_fields(link, association, content) {
  var new_id = new Date().getTime(); var regexp = new RegExp("new_" + association, "g"); $(link).before(content.replace(regexp, new_id));
}

function initBIP(title) {
  $('.best_in_place').best_in_place(); $('span.best_in_place').each(function() { $(this).attr('title', title); });
}

function show(id) { $('#'+id).show(); }
function hide(id) { $('#'+id).hide(); }
