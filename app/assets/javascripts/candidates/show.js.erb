$(document).ready(function() {
  
  $('.best_in_place').best_in_place();
  
  var arrayBIP = $('span.best_in_place');
  for(var i = 0; i < arrayBIP.length; i++)
  {
  	$('#'+arrayBIP[i].id).attr('title','Click to edit');
  }
  
  $('.edit_experience').each(function()
  {
    handleAjaxEdition($(this).attr("id"));
  });
});

function displayEditForm(model,id) {
  $('#'+model+'_edit_'+id).show();
  $('#'+model+'_'+id).hide();
}

function hideEditForm(model,id) {
  $('#'+model+'_edit_'+id).hide();
  $('#'+model+'_'+id).show();  
}

function handleAjaxEdition(form_id) {
  arrayId = form_id.split('_');
  var id = arrayId[2];
  var model = arrayId[1];
  $('#'+form_id)
    .bind("ajax:success",function(evt,data,status,xhr)
    {
   	  $.ajax({
  	  url: "showpart",
  	  type: "POST",
  	  data: {model: model, id: id},
  	  success: function(data){
  	 	$('#'+model+'_block_'+id).html(data);
  	 	handleAjaxEdition(form_id);
  	  }
  	  })
  	 })
  	 .bind("ajax:error", function(evt, xhr, status)
  	 {
  	   try {
  	     errors = $.parseJSON(xhr.responseText);
  	   }
  	   catch(err) {
  	 	 errors = {message: "JSON Error"};
  	   }
  	 	
  	   errorText = "Error(s): ";
  	   for(error in errors) {
  	 	 errorText += error+" "+errors[error]+" ";
  	   }
  	 	
  	   $('#errors'+id).html(errorText);
  	 })
  	;	
}
